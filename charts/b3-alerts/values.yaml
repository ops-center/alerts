metadata:
  resource:
    group: alerts.appscode.com
    kind: B3Alerts
    name: b3alerts
    scope: Namespaced
    version: v1alpha2
  release:
    name: ""
    namespace: ""

form:
  alert:
    enabled: warning
    labels: # +doc-gen:break
      release: kube-prometheus-stack
    annotations: {}
    additionalRuleLabels: {}

    groups:
      process:
        enabled: warning
        rules:
          b3ProcessRestarted:
            enabled: true
            duration: "0m"
            severity: warning
          b3HighGoroutineCount:
            enabled: true
            duration: "10m"
            severity: warning
            val: 10000
          b3HighGcPauseDuration:
            enabled: true
            duration: "5m"
            severity: warning
            val: 0.2
          b3HighFileDescriptorUsage:
            enabled: true
            duration: "5m"
            severity: warning
            val: 80
          # val: bytes/sec (280 ≈ 1MB/hour)
          b3MemoryLeak:
            enabled: true
            duration: "3h"
            severity: warning
            val: 280
          # val: cores/sec (0.00008 ≈ 0.29 cores/hour)
          b3CpuRunaway:
            enabled: true
            duration: "4h"
            severity: warning
            val: 0.00008
          # val: goroutines/sec (0.03 ≈ 100/hour)
          b3GoroutineLeak:
            enabled: true
            duration: "3h"
            severity: warning
            val: 0.03
          # Spike detection (short-term anomalies)
          b3MemorySpike:
            enabled: true
            duration: "0m"
            severity: info
            val: 524288000  # 500MB increase in 10m
          b3CpuSpike:
            enabled: true
            duration: "5m"
            severity: info
            val: 2  # 2 cores sustained
          b3GoroutineSpike:
            enabled: true
            duration: "0m"
            severity: info
            val: 5000  # 5000 goroutine increase in 10m

      http:
        enabled: warning
        rules:
          b3HighHttpErrorRate:
            enabled: true
            duration: "5m"
            severity: critical
            val: 5
          b3HighHttpLatency:
            enabled: true
            duration: "5m"
            severity: warning
            val: 1
          b3HighActiveRequests:
            enabled: true
            duration: "5m"
            severity: warning
            val: 1000

      database:
        enabled: warning
        rules:
          b3HighDatabaseErrorRate:
            enabled: true
            duration: "5m"
            severity: critical
            val: 5
          b3HighDatabaseLatency:
            enabled: true
            duration: "5m"
            severity: warning
            val: 0.5
          b3DatabaseConnectionErrors:
            enabled: true
            duration: "5m"
            severity: critical
            val: 5
          b3HighDatabaseConnectionPoolUsage:
            enabled: true
            duration: "5m"
            severity: warning
            val: 80

      auth:
        enabled: warning
        rules:
          b3HighAuthFailureRate:
            enabled: true
            duration: "5m"
            severity: warning
            val: 10
          b3HighAuthzDenialRate:
            enabled: true
            duration: "5m"
            severity: warning
            val: 10

      storage:
        enabled: warning
        rules:
          b3HighBlobStorageErrorRate:
            enabled: true
            duration: "5m"
            severity: warning
            val: 5

      proxy:
        enabled: warning
        rules:
          b3HighProxyErrorRate:
            enabled: true
            duration: "5m"
            severity: warning
            val: 5
          b3HighProxyLatency:
            enabled: true
            duration: "5m"
            severity: warning
            val: 5

grafana:
  enabled: false
  version: 8.2.3
  jobName: ace-platform-api
  url: ""
  apikey: ""
